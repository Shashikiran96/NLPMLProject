import pandas as pd
import xmltodict
import requests

def xmlfromURLtoodict(URL):
    response = requests.get(URL)
    odict = xmltodict.parse(response.content)
    return odict
    
def odicttodf(odict):
    df = pd.DataFrame(columns = ['cve_id', 'Description', 'Published', 'Modified'])
    i=0
    for vulnerability in odict['cvrfdoc']['Vulnerability']:
        df.loc[i,'cve_id'] = vulnerability['CVE']
    
        if type(vulnerability['Notes']['Note']) is list:
            for value in vulnerability['Notes']['Note']:
                if value['@Type']=='Description':
                    df.loc[i, value['@Type']] = value['#text']
                else:
                    df.loc[i, value['@Title']] = value['#text']
        else:
            if value['@Type']=='Description':
                df.loc[i, value['@Type']] = value['#text']
            else:
                df.loc[i, value['@Title']] = value['#text']
            
        i+=1
    
    return df
    
if __name__ == '__main__':
    odict = xmlfromURLtoodict(URL="https://cve.mitre.org/data/downloads/allitems-cvrf.xml")
    df = odicttodf(odict)
    df.to_csv('cve-allitems.csv')